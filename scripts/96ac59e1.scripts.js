"use strict";angular.module("angularTreeApp",[]),angular.module("angularTreeApp").controller("MainCtrl",["$scope",function(a){a.selectedNode=null,a.treeData=[{children:[{children:[{children:null,label:"test7",data:"test7"},{children:null,label:"test8",data:"test8"}],label:"test4",data:"test4"},{children:null,label:"test5",data:"test5"}],label:"test",data:"test"},{children:null,label:"test2",data:"test2"},{children:null,label:"test3",data:"test3"}],a.onSelect=function(b){console.log("got entry",b),a.selectedNode=b},a.deleteNode=function(a){console.log("deleting node",a),a.removeNode()},a.addNode=function(b){console.log("adding node",b),a.selectedNode.addChild({},b.label)},a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("angularTreeApp").directive("rctTree",function(){return{scope:{treeData:"=",currentlySelected:"=",onTreeSelect:"&"},template:'<ul class="list-unstyled"><rct-node ng-repeat="node in tree.children" node="node"></rct-node></ul>',restrict:"EA",replace:"true",controller:["$scope",function(a){this.currentLevel=1,this.selectedNode=null;var b=function(a,b){for(var c=a;c;){if(!c)return;c.selected=b,c=c.parent}};this.onSelect=function(c){b(this.selectedNode,!1),b(c,!0),console.log("got node in onSelect tree",c),a.onTreeSelect({node:c}),this.selectedNode=c}}],link:function(a){function b(){var a=new c(null,null);return a.expanded=!0,this.getRoot=function(){return a},this}function c(a,b,d,f){var g=this;this.children=[],this.parent=a||null,this.data=b||null,this.label=d||null,this.id=f||e(),this.level=0,this.parent&&(this.level=this.parent.level+1),this.addChild=function(a,b,d){var e=new c(g,a,b,d);return g.children.push(e),e},this.removeNode=function(){console.log("removing node");var a=g.parent;if(a)for(var b=a.children,c=0;b>c;c++)b[c].id===g.id&&(console.log("children before",b),delete b.splice(c,1)[0],console.log("children after",b));delete g.children,delete g.parent,delete g.id,delete g.data,g.elem.remove()}}function d(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function e(){return d()+d()+"-"+d()+"-"+d()+"-"+d()+"-"+d()+d()+d()}function f(a,b,c,d){if(d||(d=0),b)for(var e=0;e<b.length;e++){var g=a.addChild(b[e].data,b[e].label,b[e].id);a.expanded&&(g.shown=!0),c>d&&b[e].children&&(g.expanded=!0),b[e].children&&f(g,b[e].children,c,d+1)}}a.$watch("treeData",function(c){console.log("watching tree data?");var d=new b,e=d.getRoot();f(e,c,1),a.tree=d.getRoot(),console.log(a.tree)}),a.tree=null}}}),angular.module("angularTreeApp").directive("rctNode",["$compile",function(a){return{scope:{node:"="},template:'<li ng-show="isNodeShown(node)" ng-style="getMargin(node)"></li>',restrict:"EA",replace:!0,require:"^rctTree",link:function(b,c,d,e){b.nodeSelect=function(a){e.onSelect(a)},b.expandNode=function(a){var b=function(a,c,d,e){if(a)for(var f=0;f<a.length;f++)a[f].expanded=c,a[f].shown=d,e||b(a[f].children,c,d,e)};a.expanded?(a.expanded=!1,b(a.children,!1,!1,!1)):(a.expanded=!0,b(a.children,!1,!0,!0))},b.isNodeSelected=function(a){return a.selected},b.isNodeExpanded=function(a){return a.expanded},b.isNodeShown=function(a){return a.shown},b.getMargin=function(a){for(var b=a,c=0;b;)c++,b=b.parent;return{"margin-left":15*c+"px"}},a('<li ng-show="isNodeShown(node)"><span class="glyphicon glyphicon-plus" ng-click="expandNode(node)" ng-show="node.children.length"></span><span ng-click="nodeSelect(node)">{{node.label}}</span></li><ul class="list-unstyled"><rct-node ng-repeat="node in node.children" node="node"></rct-node></ul>')(b,function(a){b.node.elem=a,c.append(a)})}}}]);